{% set user = currentUser %}
{% set will_receive_new_statement_notification = ("RMOPSM" in user.roles or "RMOPSA" in user.roles or "RMOPPO" in user.roles )? true : false %}
{% set may_edit_orga_data = true %}
{% set organisationData = {
    id: organisation.ident|default,
    name: organisation.nameLegal|default,
    street: organisation.street|default,
    houseNumber: organisation.houseNumber|default,
    postalcode: organisation.postalcode|default,
    city: organisation.city|default,
    phone: organisation.phone|default,
    currentSlugName: organisation.currentSlug.name|default,
    emailReviewerAdmin: organisation.emailReviewerAdmin|default,
    emailNotificationNewStatement: organisation.notifications.emailNotificationNewStatement|default({}),
    emailNotificationEndingPhase: organisation.notifications.emailNotificationEndingPhase|default({}),
    email2: organisation.email2|default,
    ccEmail2: organisation.ccEmail2|default,
    paperCopy: organisation.paperCopy|default,
    paperCopySpec: organisation.paperCopySpec|default,
    competence: organisation.competence|default,
    showname: organisation.showname|default,
    dataProtection: organisation.dataProtection|default,
    imprint: organisation.imprint|default,
    submissionType: organisation.submissionType|default
} %}

{% set userData = {
    isPublicAgency: user.isPublicAgency
} %}

{% set customers = [] %}
{% for customer in organisation.customers|default([]) %}
    {% set customers = customers|merge([{id: customer.id, name: customer.name}]) %}
{% endfor %}

{% set submissionTypeDefault = templateVars.submissionTypeDefault %}
{% set submissionTypeShort = templateVars.submissionTypeShort %}

{% block organisationData %}
    <organisation-data-field
        submission-type-default="{{ submissionTypeDefault }}"
        submission-type-short="{{ submissionTypeShort }}"
        :customers="JSON.parse('{{ customers|default([])|json_encode|e('js', 'utf-8') }}')"
        :is-orga-data-editable="Boolean({{ may_edit_orga_data }})"
        :procedures-directlink-prefix="JSON.parse('{{ templateVars.proceduresDirectlinkPrefix|json_encode|e('js', 'utf-8') }}')"
        :organisation="JSON.parse('{{ organisationData |default({})|json_encode|e('js', 'utf-8') }}')"
        display-full-data>
    </organisation-data-field>
{% endblock organisationData %}

{# Email & Notification settings #}
<email-notifications-field
    :user="JSON.parse('{{ userData|json_encode|e('js', 'utf-8') }}')"
    :organisation="JSON.parse('{{ organisationData |default({})|json_encode|e('js', 'utf-8') }}')"
    :will-receive-new-statement-notification="Boolean({{ will_receive_new_statement_notification }})">
</email-notifications-field>


{% block paper_copy %}
    <paper-copy-field
        :organisation="JSON.parse('{{ organisationData |default({})|json_encode|e('js', 'utf-8') }}')">
    </paper-copy-field>
{% endblock paper_copy %}

<orga-branding-field
    :organisation="JSON.parse('{{ organisationData |default({})|json_encode|e('js', 'utf-8') }}')"
    project-name="{{ projectName }}">
</orga-branding-field>

{% block buttonRow %}
    {{ uiComponent('button-row', {
        primary: uiComponent('button', { type: 'submit' }),
        secondary: uiComponent('button', { color: 'secondary', type: 'reset' })
    }) }}
{% endblock buttonRow %}
