{% extends '@DemosPlanCore/DemosPlanCore/procedure.html.twig' %}


{% block demosplanbundlecontent %}

<form
    action="{{ path('dplan_procedure_mail_send_all_submitters_send', {'procedureId': templateVars.procedureId}) }}"
    method="post"
    data-dp-validate
>

    <fieldset>
        <legend>
            <h1>
                {{ 'procedure.mail.submitters.write'|trans }}
            </h1>
        </legend>

        <p>{{ 'procedure.mail.submitters.help'|trans }}</p>

        {% if templateVars.mailsCount == 0 %}
        <p class="flash flash-info">
            {{ 'procedure.mail.submitters.none.hint'|trans}}
        </p>
        {% endif %}

        {{ uiComponent('form.row', {
            elements: [
                {
                    label: { text: 'subject'|trans },
                    control: { name: 'r_email_subject', attributes: ['maxlength=78'] },
                    id: 'r_email_subject',
                    type: 'text',
                    required: true,
                    value: templateVars.preparationMail.mailSubject
                }
            ]
        }) }}

        {{ uiComponent('form.row', {
            elements: [
                {
                    label: { text: 'email.body'|trans },
                    control: {
                        name: 'r_email_body',
                        boilerPlate: 'email',
                        toolbarItems: { headings: [1,2,3] },
                        hiddenInput: 'r_email_body',
                        linkButton: true,
                        procedureId: templateVars.procedureId
                    },
                    id: 'r_email_body',
                    type: 'editor',
                    required: true,
                    value: templateVars.preparationMail.mailBody
                }
            ]
        }) }}

        <dp-checkbox
            id="r_email_address"
            name="r_email_address"
            valueToSend="{{ templateVars.preparationMail.sendMail }}"
            label="{{ 'procedure.testmail.submitters.send'|trans ({ email: templateVars.userMail }) }}"
            tooltip="{{ 'explanation.organisation.email.procedure.agency'|trans }}"
            checked
            required>
        </dp-checkbox>

        <div class="text--right">
            <button
                    class="btn btn--primary"
                    data-cy="emailContinueConfirm"
                    type="submit"
                    name="send"
                    {% if templateVars.mailsCount == 0 %}disabled="disabled"
                    class="bg-color--grey"
                {% endif %}
            >
                {{ 'continue.confirm'|trans }}
                <i class="fa fa-angle-right u-pl-0_25" aria-hidden="true"></i>
            </button>
        </div>

    </fieldset>
</form>

{% endblock demosplanbundlecontent %}

{#  bundles generated via webpack/gulp build are included here  #}
{% block javascripts %}
    {{ parent() }}
    {{ webpackBundles(['tiptap.js', 'procedure-administrationSendEmail.js']) }}
{% endblock javascripts %}
